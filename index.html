<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squarespace Recipe Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Removed external CSS link to keep everything self-contained -->
    <style>
        body {
            margin: 0;
            font-family: 'Arial', sans-serif;
            background: #f4f4f4;
            color: #000;
        }
        .container {
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        header h1 {
            margin: 0;
            color: #000;
            font-size: 2.2rem;
        }
        header h1 i {
            color: #000;
        }
        .subtitle {
            color: #555;
            font-style: italic;
            font-size: 1.1rem;
        }
        .app-container {
            display: flex;
            gap: 20px;
        }
        .form-section {
            flex: 1;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .preview-section {
            flex: 1;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #000;
        }
        input[type="text"], textarea, input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
            color: #000;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        .list-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        .list-item input {
            flex: 1;
        }
        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .btn-add {
            background: #000;
            color: white;
        }
        .btn-remove {
            background: #666;
            color: white;
        }
        /* Clean Black & White Code Output */
        #code-output {
            background: white;
            color: #000;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            white-space: pre-wrap;
            word-break: break-all;
            min-height: 150px;
            max-height: 250px;
            overflow-y: auto;
            margin-bottom: 15px;
            line-height: 1.3;
        }
        .actions {
            display: flex;
            gap: 10px;
        }
        .btn-generate {
            background: #000;
            color: white;
            flex: 1;
        }
        .btn-copy {
            background: #555;
            color: white;
            flex: 1;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            color: #666;
            font-size: 0.9rem;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: -300px;
            background: #000;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: right 0.3s ease;
            z-index: 1000;
            font-size: 0.95rem;
        }
        .notification.show {
            right: 20px;
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1><i class="fas fa-utensils"></i> Squarespace Recipe Generator</h1>
        <p class="subtitle">Create elegant, professional recipes for your Squarespace site</p>
    </header>
    <div class="app-container">
        <div class="form-section">
            <h2>Recipe Details</h2>
            <div class="form-group">
                <label for="recipe-title">Recipe Title</label>
                <input type="text" id="recipe-title" placeholder="e.g., Classic Chocolate Chip Cookies">
            </div>
            <div class="form-group">
                <label for="recipe-description">Description</label>
                <textarea id="recipe-description" placeholder="A brief description of your recipe..."></textarea>
            </div>
            <div class="form-group">
                <label for="prep-time">Prep Time (minutes)</label>
                <input type="number" id="prep-time" placeholder="e.g., 15">
            </div>
            <div class="form-group">
                <label for="cook-time">Cook Time (minutes)</label>
                <input type="number" id="cook-time" placeholder="e.g., 12">
            </div>
            <div class="form-group">
                <label for="servings">Servings</label>
                <input type="number" id="servings" placeholder="e.g., 4">
            </div>
            <h2>Ingredients</h2>
            <ul id="ingredients-list">
                <li class="list-item">
                    <input type="text" placeholder="e.g., 2 cups all-purpose flour">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., 1 tsp baking soda">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., 1/2 tsp salt">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., 1 cup butter">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., 3/4 cup sugar">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., 3/4 cup brown sugar">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., 2 large eggs">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., 2 tsp vanilla">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., 2 cups chocolate chips">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
            </ul>
            <button class="btn btn-add" onclick="addItem('ingredients')">Add Ingredient</button>
            <h2>Instructions</h2>
            <ul id="instructions-list">
                <li class="list-item">
                    <input type="text" placeholder="e.g., Preheat oven to 375°F (190°C)">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., Mix ingredients together">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., Mix ingredients together">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., Mix ingredients together">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., Mix ingredients together">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., Mix ingredients together">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., Mix ingredients together">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., Mix ingredients together">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., Mix ingredients together">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
            </ul>
            <button class="btn btn-add" onclick="addItem('instructions')">Add Instruction</button>
            <h2>Tips</h2>
            <ul id="tips-list">
                <li class="list-item">
                    <input type="text" placeholder="e.g., Use room temperature ingredients for best results">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., Pro tip for better results">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., Pro tip for better results">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., Pro tip for better results">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
            </ul>
            <button class="btn btn-add" onclick="addItem('tips')">Add Tip</button>
            <h2>Tools & Equipment</h2>
            <ul id="equipment-list">
                <li class="list-item">
                    <input type="text" placeholder="e.g., Large mixing bowl">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., Electric mixer">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., 9-inch baking pan">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
                <li class="list-item">
                    <input type="text" placeholder="e.g., Wire cooling rack">
                    <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
                </li>
            </ul>
            <button class="btn btn-add" onclick="addItem('equipment')">Add Equipment</button>
        </div>
        <div class="preview-section">
            <h2>Generated Code</h2>
            <p>Copy the code below and paste it into a Squarespace Code Block:</p>
            <div id="code-output">Click "Generate Code" to create your Squarespace recipe block.</div>
            <div class="actions">
                <button class="btn btn-generate" onclick="generateCode()">Generate Code</button>
                <button class="btn btn-copy" onclick="copyCode()">Copy to Clipboard</button>
                <button class="btn" style="background: #333; color: white;" onclick="loadTestData()">Load Test Data</button>
                <button class="btn" style="background: #444; color: white;" onclick="downloadPDF()"><i class="fas fa-download"></i> Download PDF</button>
            </div>
        </div>
    </div>
    <footer>
        <p>Made with <i class="fas fa-heart" style="color: #000;"></i> for Culinary Professionals</p>
    </footer>
</div>
<div class="notification" id="notification">Code copied to clipboard!</div>

<script>
    function addItem(type) {
        const list = document.getElementById(type + '-list');
        const newItem = document.createElement('li');
        newItem.className = 'list-item';
        let placeholder = '';
        if (type === 'instructions') placeholder = 'e.g., Mix ingredients together';
        else if (type === 'tips') placeholder = 'e.g., Pro tip for better results';
        else if (type === 'equipment') placeholder = 'e.g., Kitchen tool or equipment needed';
        newItem.innerHTML = `
            <input type="text" placeholder="${placeholder}">
            <button class="btn btn-remove" onclick="removeItem(this)"><i class="fas fa-times"></i></button>
        `;
        list.appendChild(newItem);
    }



    function removeItem(button) {
        const item = button.closest('li');
        const list = item.parentNode;
        if (list.children.length > 1) {
            item.remove();
        } else {
            item.querySelector('input').value = '';
        }
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }



    function metricToUs(text) {
        return text
            .replace(/(\d*\.?\d+)\s*ml/gi, (match, qty) => {
                const value = parseFloat(qty);
                if (value >= 240) {
                    const cups = value / 240;
                    const fraction = toFraction(cups);
                    return fraction ? fraction + ' cups' : (cups.toFixed(2).replace(/\.00$/, '') + ' cups');
                } else if (value >= 15) {
                    const tbsp = value / 15;
                    const fraction = toFraction(tbsp);
                    return fraction ? fraction + ' tbsp' : (tbsp.toFixed(1) + ' tbsp');
                } else {
                    const tsp = value / 5;
                    const fraction = toFraction(tsp);
                    return fraction ? fraction + ' tsp' : (tsp.toFixed(1) + ' tsp');
                }
            })
            .replace(/(\d*\.?\d+)\s*grams?/gi, (match, qty) => {
                const value = parseFloat(qty);
                if (value >= 454) {
                    const lbs = value / 454;
                    const fraction = toFraction(lbs);
                    return fraction ? fraction + ' lb' : (lbs.toFixed(2) + ' lb');
                } else {
                    const oz = value / 28;
                    const fraction = toFraction(oz);
                    return fraction ? fraction + ' oz' : (oz.toFixed(1) + ' oz');
                }
            })
            .replace(/(\d+)°C/g, (match, c) => {
                const f = Math.round(parseFloat(c) * 9 / 5 + 32);
                return f + '°F';
            });
    }

    function generateCode() {
    const title = document.getElementById('recipe-title').value || 'Delicious Recipe';
    const description = document.getElementById('recipe-description').value || 'A wonderful recipe to try.';
    const prepTime = parseInt(document.getElementById('prep-time').value) || 15;
    const cookTime = parseInt(document.getElementById('cook-time').value) || 30;
    const servings = parseInt(document.getElementById('servings').value) || 4;

    const ingredients = Array.from(document.querySelectorAll('#ingredients-list input'))
        .map(input => input.value.trim())
        .filter(value => value);

    const instructions = Array.from(document.querySelectorAll('#instructions-list input'))
        .map(input => input.value.trim())
        .filter(value => value);

    const tips = Array.from(document.querySelectorAll('#tips-list input'))
        .map(input => input.value.trim())
        .filter(value => value);

    const equipment = Array.from(document.querySelectorAll('#equipment-list input'))
        .map(input => input.value.trim())
        .filter(value => value);

    const recipeId = 'recipe-' + Date.now();
    const scaleGroupId = `scale-group-${Date.now()}`;

    // Scaling factors
    const scales = [1, 1.5, 2, 3, 4];
    const scaleLabels = ['x1', 'x1.5', 'x2', 'x3', 'x4'];

    // Pre-calculate scaled times and servings
    // Note: Both prep and cook times stay constant - only servings scale
    const scaledTimes = scales.map(scale => ({
        prep: prepTime, // Prep time stays constant regardless of batch size
        cook: cookTime, // Cook time doesn't change with servings
        servings: Math.round(servings * scale)
    }));

    // Safe fraction parsing (no eval!)
    function parseFraction(value) {
        const fractionMap = {
            '¼': 0.25, '½': 0.5, '¾': 0.75,
            '⅓': 0.33, '⅔': 0.67,
            '1/4': 0.25, '1/2': 0.5, '3/4': 0.75,
            '1/3': 0.33, '2/3': 0.67
        };
        
        // Handle unicode fractions
        if (fractionMap[value]) return fractionMap[value];
        
        // Handle mixed numbers like "2 1/4"
        const mixedMatch = value.match(/(\d+)\s+(\d+)\/(\d+)/);
        if (mixedMatch) {
            const whole = parseFloat(mixedMatch[1]);
            const numerator = parseFloat(mixedMatch[2]);
            const denominator = parseFloat(mixedMatch[3]);
            if (!isNaN(whole) && !isNaN(numerator) && !isNaN(denominator) && denominator !== 0) {
                return whole + (numerator / denominator);
            }
        }
        
        // Handle simple fractions like "3/4"
        const parts = value.split('/').map(Number);
        if (parts.length === 2 && !isNaN(parts[0]) && !isNaN(parts[1]) && parts[1] !== 0) {
            return parts[0] / parts[1];
        }
        
        // Handle simple numbers
        const num = parseFloat(value);
        return isNaN(num) ? 1 : num;
    }

    // Smart scaling for instructions - scales appropriate quantities but preserves measurements, temperatures, cooking times, etc.
    function parseAndScaleIngredient(text, scale) {
        const protectedItems = new Map();
        let counter = 0;
        
        // Protect temperatures
        let protectedText = text.replace(/\b(\d+(?:\.\d+)?)\s*(?:°[FC]|degrees?\s*[FC]?|[FC])\b/gi, (match) => {
            const placeholder = `__TEMP_${counter}__`;
            protectedItems.set(placeholder, match);
            counter++;
            return placeholder;
        });
        
        // Protect physical measurements - more comprehensive patterns
        // Pattern 1: Fractions with measurements (1/8 inch, 2 1/4 inches)  
        protectedText = protectedText.replace(/\b(\d+(?:\s+\d+\/\d+|\.\d+)?|\d+\/\d+)\s+(inch(?:es)?|cm|mm|feet?|yards?)\b(?:\s+(?:apart|thick|wide|deep|diameter|across|long|high))?/gi, (match) => {
            const placeholder = `__MEASURE_${counter}__`;
            protectedItems.set(placeholder, match);
            counter++;
            return placeholder;
        });
        
        // Pattern 2: Hyphenated sizes (9-inch, 12-inch)
        protectedText = protectedText.replace(/\b(\d+(?:\.\d+)?)-(?:inch|cm|mm)\b/gi, (match) => {
            const placeholder = `__SIZE_${counter}__`;
            protectedItems.set(placeholder, match);
            counter++;
            return placeholder;
        });
        
        // Protect ALL time references - comprehensive patterns
        // Format: "25 minutes", "2 hours", "25-30 mins", "2.5 hours", "25min", etc.
        protectedText = protectedText.replace(/\b(\d+(?:\.\d+|½|¼|¾)?(?:\s*-\s*\d+(?:\.\d+|½|¼|¾)?)?)\s*(?:minutes?|mins?|hours?|hrs?|seconds?|secs?)\b/gi, (match) => {
            const placeholder = `__TIME_${counter}__`;
            protectedItems.set(placeholder, match);
            counter++;
            return placeholder;
        });
        
        // Protect heat/temperature descriptions
        protectedText = protectedText.replace(/\b(?:low|medium|high|very low|very high)\s+(?:heat|temperature|temp)\b/gi, (match) => {
            const placeholder = `__HEAT_${counter}__`;
            protectedItems.set(placeholder, match);
            counter++;
            return placeholder;
        });
        
        // Protect equipment settings and levels
        protectedText = protectedText.replace(/\b(?:heat\s+level|speed|setting|level|rack\s+position|position)\s+(\d+)/gi, (match) => {
            const placeholder = `__SETTING_${counter}__`;
            protectedItems.set(placeholder, match);
            counter++;
            return placeholder;
        });
        
        // Protect ratios and percentages
        protectedText = protectedText.replace(/\b(\d+(?:\.\d+)?:\d+(?:\.\d+)?|\d+\s+to\s+\d+|\d+(?:\.\d+)?%|\d+\s+percent)\b/gi, (match) => {
            const placeholder = `__RATIO_${counter}__`;
            protectedItems.set(placeholder, match);
            counter++;
            return placeholder;
        });
        
        // Protect sequential instruction numbers
        protectedText = protectedText.replace(/\b(?:step|stage|part|phase)\s+(\d+)/gi, (match) => {
            const placeholder = `__SEQUENCE_${counter}__`;
            protectedItems.set(placeholder, match);
            counter++;
            return placeholder;
        });
        
        // Protect internal temperatures and scientific measurements
        protectedText = protectedText.replace(/\b(\d+(?:\.\d+)?)\s*(?:°[FC]\s+internal|internal\s+temp|pH)\b/gi, (match) => {
            const placeholder = `__SCIENTIFIC_${counter}__`;
            protectedItems.set(placeholder, match);
            counter++;
            return placeholder;
        });
        
        
        // Now scale remaining quantities (ingredient amounts, counts, but NOT times/temperatures/measurements)
        const scaledText = protectedText.replace(/(\d+\s+\d+\/\d+|\d*\.?\d+\/\d+|\d*\.?\d+|[¼½¾⅓⅔])/g, qty => {
            const decimal = parseFraction(qty.trim());
            const scaled = decimal * scale;
            const fraction = toFraction(scaled);
            return fraction || (isNaN(scaled) ? qty : scaled.toFixed(2).replace(/\.00$/, ''));
        });
        
        // Restore all protected items (use global replace for safety)
        let finalText = scaledText;
        protectedItems.forEach((original, placeholder) => {
            finalText = finalText.replace(new RegExp(placeholder.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g'), original);
        });
        
        return finalText;
    }

    // Convert decimal to simple fraction (e.g., 0.5 → "1/2")
    function toFraction(decimal) {
        const tolerance = 1e-6;
        for (let d = 1; d <= 12; d++) {
            for (let n = 0; n <= d; n++) {
                if (Math.abs(n / d - decimal) < tolerance) {
                    if (n === 0) return '0';
                    if (n === d) return '1';
                    return n + '/' + d;
                }
            }
        }
        return null;
    }

    // US to Metric conversion
    function usToMetric(text) {
        return text
            .replace(/(\d*\.?\d+|[¼½¾⅓⅔]|\d+\/\d+)\s*cup(?:s)?/gi, (match, qty) => {
                const value = parseFraction(qty);
                return Math.round(value * 240) + ' ml';
            })
            .replace(/(\d*\.?\d+|[¼½¾⅓⅔]|\d+\/\d+)\s*(tablespoon|tbsp)/gi, (match, qty, unit) => {
                const value = parseFraction(qty);
                return Math.round(value * 15) + ' ml';
            })
            .replace(/(\d*\.?\d+|[¼½¾⅓⅔]|\d+\/\d+)\s*(teaspoon|tsp)/gi, (match, qty, unit) => {
                const value = parseFraction(qty);
                return Math.round(value * 5) + ' ml';
            })
            .replace(/(\d*\.?\d+|[¼½¾⅓⅔]|\d+\/\d+)\s*(ounce|oz)/gi, (match, qty, unit) => {
                const value = parseFraction(qty);
                return Math.round(value * 28) + ' grams';
            })
            .replace(/(\d*\.?\d+|[¼½¾⅓⅔]|\d+\/\d+)\s*(pound|lb)/gi, (match, qty, unit) => {
                const value = parseFraction(qty);
                return Math.round(value * 454) + ' grams';
            })
            // Handle dimensional measurements like "14x10 inches" or "9-inch"
            .replace(/(\d+(?:\.\d+)?)\s*x\s*(\d+(?:\.\d+)?)\s*inch(?:es)?/gi, (match, w, h) => {
                const widthCm = Math.round(parseFloat(w) * 2.54);
                const heightCm = Math.round(parseFloat(h) * 2.54);
                return `${widthCm}x${heightCm} cm`;
            })
            .replace(/(\d+(?:\.\d+)?)-inch/gi, (match, size) => {
                const cm = Math.round(parseFloat(size) * 2.54);
                return `${cm} cm`;
            })
            .replace(/(\d+(?:\.\d+)?)\s*inch(?:es)?/gi, (match, size) => {
                const cm = Math.round(parseFloat(size) * 2.54);
                return `${cm} cm`;
            })
            // Handle "375°F (190°C)" format - extract just the Celsius part
            .replace(/(\d+)°F\s*\((\d+)°C\)/g, (match, f, c) => {
                return c + '°C';
            })
            // Handle standalone "375°F" format
            .replace(/(\d+)°F/g, (match, f) => {
                const c = Math.round((parseFloat(f) - 32) * 5 / 9);
                return c + '°C';
            });
    }

    // Pre-generate scaled ingredients (US and Metric)
    const scaledIngredients = scales.map(scale => {
        const us = ingredients.map(ing => parseAndScaleIngredient(ing, scale));
        const metric = ingredients.map(ing => parseAndScaleIngredient(usToMetric(ing), scale));
        return { us, metric };
    });

    // Build code in chunks to avoid VS Code parsing issues
    const codeParts = [];

    codeParts.push(`<!-- Recipe with Unit & Scale Toggle -->`);
    codeParts.push(`<style>`);
    codeParts.push(`    .recipe-container {`);
    codeParts.push(`        font-family: 'Georgia', serif;`);
    codeParts.push(`        max-width: 800px;`);
    codeParts.push(`        margin: 0 auto;`);
    codeParts.push(`        padding: 30px;`);
    codeParts.push(`        background: #ffffff;`);
    codeParts.push(`        border: 2px solid #000000;`);
    codeParts.push(`        box-shadow: 0 8px 20px rgba(0,0,0,0.15);`);
    codeParts.push(`    }`);
    
    // Control selectors - shared styling
    codeParts.push(`    .control-selector {`);
    codeParts.push(`        display: flex;`);
    codeParts.push(`        justify-content: center;`);
    codeParts.push(`        gap: 5px;`);
    codeParts.push(`        margin-bottom: 15px;`);
    codeParts.push(`    }`);
    codeParts.push(`    .control-selector input {`);
    codeParts.push(`        display: none;`);
    codeParts.push(`    }`);
    codeParts.push(`    .control-selector label {`);
    codeParts.push(`        padding: 8px 16px;`);
    codeParts.push(`        border: 2px solid #ccc;`);
    codeParts.push(`        border-radius: 5px;`);
    codeParts.push(`        cursor: pointer;`);
    codeParts.push(`        font-weight: 500;`);
    codeParts.push(`        font-size: 0.9rem;`);
    codeParts.push(`        transition: all 0.2s;`);
    codeParts.push(`    }`);
    codeParts.push(`    .control-selector label:hover {`);
    codeParts.push(`        background: #f0f0f0;`);
    codeParts.push(`    }`);
    
    // Unit selector - fixed selectors
    codeParts.push(`    #${scaleGroupId}-us-ctrl:checked ~ * .unit-selector label[for='${scaleGroupId}-us-ctrl'] {`);
    codeParts.push(`        background: #000;`);
    codeParts.push(`        color: white;`);
    codeParts.push(`        border-color: #000;`);
    codeParts.push(`    }`);
    codeParts.push(`    #${scaleGroupId}-metric-ctrl:checked ~ * .unit-selector label[for='${scaleGroupId}-metric-ctrl'] {`);
    codeParts.push(`        background: #000;`);
    codeParts.push(`        color: white;`);
    codeParts.push(`        border-color: #000;`);
    codeParts.push(`    }`);
    // Hide all unit/temp combinations by default
    codeParts.push(`    .us-unit, .metric-unit {`);
    codeParts.push(`        display: none;`);
    codeParts.push(`    }`);
    
    // Show specific combinations based on both unit and temperature selections
    codeParts.push(`    #${scaleGroupId}-us-ctrl:checked ~ #${scaleGroupId}-fahr-ctrl:checked ~ * .us-unit.fahrenheit-temp {`);
    codeParts.push(`        display: inline;`);
    codeParts.push(`    }`);
    codeParts.push(`    #${scaleGroupId}-us-ctrl:checked ~ #${scaleGroupId}-cels-ctrl:checked ~ * .us-unit.celsius-temp {`);
    codeParts.push(`        display: inline;`);
    codeParts.push(`    }`);
    codeParts.push(`    #${scaleGroupId}-metric-ctrl:checked ~ #${scaleGroupId}-fahr-ctrl:checked ~ * .metric-unit.fahrenheit-temp {`);
    codeParts.push(`        display: inline;`);
    codeParts.push(`    }`);
    codeParts.push(`    #${scaleGroupId}-metric-ctrl:checked ~ #${scaleGroupId}-cels-ctrl:checked ~ * .metric-unit.celsius-temp {`);
    codeParts.push(`        display: inline;`);
    codeParts.push(`    }`);
    
    // Handle ingredients (no temperature classes - just unit classes)
    codeParts.push(`    #${scaleGroupId}-us-ctrl:checked ~ * .us-unit:not(.fahrenheit-temp):not(.celsius-temp) {`);
    codeParts.push(`        display: inline;`);
    codeParts.push(`    }`);
    codeParts.push(`    #${scaleGroupId}-metric-ctrl:checked ~ * .metric-unit:not(.fahrenheit-temp):not(.celsius-temp) {`);
    codeParts.push(`        display: inline;`);
    codeParts.push(`    }`);
    
    // Temperature selector button styling
    codeParts.push(`    #${scaleGroupId}-fahr-ctrl:checked ~ * .temp-selector label[for='${scaleGroupId}-fahr-ctrl'] {`);
    codeParts.push(`        background: #000;`);
    codeParts.push(`        color: white;`);
    codeParts.push(`        border-color: #000;`);
    codeParts.push(`    }`);
    codeParts.push(`    #${scaleGroupId}-cels-ctrl:checked ~ * .temp-selector label[for='${scaleGroupId}-cels-ctrl'] {`);
    codeParts.push(`        background: #000;`);
    codeParts.push(`        color: white;`);
    codeParts.push(`        border-color: #000;`);
    codeParts.push(`    }`);

    // Scale Selector
    codeParts.push(`    .scale-selector {`);
    codeParts.push(`        display: flex;`);
    codeParts.push(`        justify-content: center;`);
    codeParts.push(`        gap: 5px;`);
    codeParts.push(`        margin-bottom: 20px;`);
    codeParts.push(`        flex-wrap: wrap;`);
    codeParts.push(`    }`);
    codeParts.push(`    .scale-selector input {`);
    codeParts.push(`        display: none;`);
    codeParts.push(`    }`);
    codeParts.push(`    .scale-selector label {`);
    codeParts.push(`        padding: 8px 12px;`);
    codeParts.push(`        border: 2px solid #ccc;`);
    codeParts.push(`        border-radius: 5px;`);
    codeParts.push(`        cursor: pointer;`);
    codeParts.push(`        font-weight: 500;`);
    codeParts.push(`        font-size: 0.95rem;`);
    codeParts.push(`        transition: all 0.2s;`);
    codeParts.push(`        min-width: 40px;`);
    codeParts.push(`        text-align: center;`);
    codeParts.push(`    }`);
    codeParts.push(`    .scale-selector label:hover {`);
    codeParts.push(`        background: #f0f0f0;`);
    codeParts.push(`    }`);

    scales.forEach((_, i) => {
        codeParts.push(`    #${scaleGroupId}-s${i}-ctrl:checked ~ .scale-selector label[for='${scaleGroupId}-s${i}-ctrl'] {`);
        codeParts.push(`        background: #000;`);
        codeParts.push(`        color: white;`);
        codeParts.push(`        border-color: #000;`);
        codeParts.push(`    }`);
    });

    scales.forEach((_, i) => {
        // Direct approach: each radio shows only its corresponding scale
        codeParts.push(`    #${scaleGroupId}-s${i}-ctrl:checked ~ .recipe-container .scale-${i} {`);
        codeParts.push(`        display: block !important;`);
        codeParts.push(`    }`);
    });

    codeParts.push(`    .scale-content {`);
    codeParts.push(`        display: none;`);
    codeParts.push(`    }`);
    codeParts.push(`</style>`);

    // Unit toggle inputs
    codeParts.push(`<input type="radio" name="${scaleGroupId}-unit-ctrl" id="${scaleGroupId}-us-ctrl" style="display:none;" checked>`);
    codeParts.push(`<input type="radio" name="${scaleGroupId}-unit-ctrl" id="${scaleGroupId}-metric-ctrl" style="display:none;">`);
    
    // Temperature toggle inputs
    codeParts.push(`<input type="radio" name="${scaleGroupId}-temp-ctrl" id="${scaleGroupId}-fahr-ctrl" style="display:none;" checked>`);
    codeParts.push(`<input type="radio" name="${scaleGroupId}-temp-ctrl" id="${scaleGroupId}-cels-ctrl" style="display:none;">`);
    

    // Place radio inputs FIRST so they can control both scale-selector and recipe-container
    scales.forEach((_, i) => {
        codeParts.push(`<input type="radio" name="${scaleGroupId}-ctrl" id="${scaleGroupId}-s${i}-ctrl" class="scale-radio" style="display:none;" ${i === 0 ? 'checked' : ''}>`);
    });

    codeParts.push(`<div class="scale-selector">`);
    scaleLabels.forEach((label, i) => {
        codeParts.push(`    <label for="${scaleGroupId}-s${i}-ctrl">${label}</label>`);
    });
    codeParts.push(`</div>`);

    codeParts.push(`<div class="recipe-container" id="${recipeId}">`);
    codeParts.push(`  <h1 style="font-family: 'Playfair Display', serif; color: #000000; text-align: center; margin-bottom: 15px; font-size: 2.4rem; font-weight: 700;">${escapeHtml(title)}</h1>`);
    codeParts.push(`  <p style="text-align: center; color: #333333; font-style: italic; margin-bottom: 30px; font-size: 1.1rem; line-height: 1.6;">${escapeHtml(description)}</p>`);

    // Scaled Times and Servings
    scales.forEach((_, i) => {
        codeParts.push(`  <div class="scale-content scale-${i}">`);
        codeParts.push(`    <div style="display: flex; justify-content: space-around; flex-wrap: wrap; margin-bottom: 35px; border-top: 2px solid #000000; border-bottom: 2px solid #000000; padding: 20px 0;">`);
        codeParts.push(`      <div style="text-align: center; padding: 18px;">`);
        codeParts.push(`        <div style="font-weight: 600; color: #000000; font-size: 1rem; letter-spacing: 1px;">PREP TIME</div>`);
        codeParts.push(`        <div style="font-size: 1.3rem; font-weight: 500; margin-top: 5px; color: #333333;">${scaledTimes[i].prep} mins</div>`);
        codeParts.push(`      </div>`);
        codeParts.push(`      <div style="text-align: center; padding: 18px;">`);
        codeParts.push(`        <div style="font-weight: 600; color: #000000; font-size: 1rem; letter-spacing: 1px;">COOK TIME</div>`);
        codeParts.push(`        <div style="font-size: 1.3rem; font-weight: 500; margin-top: 5px; color: #333333;">${scaledTimes[i].cook} mins</div>`);
        codeParts.push(`      </div>`);
        codeParts.push(`      <div style="text-align: center; padding: 18px;">`);
        codeParts.push(`        <div style="font-weight: 600; color: #000000; font-size: 1rem; letter-spacing: 1px;">SERVINGS</div>`);
        codeParts.push(`        <div style="font-size: 1.3rem; font-weight: 500; margin-top: 5px; color: #333333;">${scaledTimes[i].servings}</div>`);
        codeParts.push(`      </div>`);
        codeParts.push(`    </div>`);
        codeParts.push(`  </div>`);
    });

    // Equipment Section (if any)
    if (equipment.length > 0) {
        codeParts.push(`  <div style="margin-bottom: 30px; border-top: 2px solid #000000; padding-top: 25px;">`);
        codeParts.push(`    <h2 style="color: #000000; border-bottom: 3px solid #000000; padding-bottom: 8px; margin-bottom: 20px; font-size: 1.8rem; font-weight: 600;">Tools & Equipment</h2>`);
        codeParts.push(`    <ul style="list-style-type: none; padding-left: 0; font-size: 1.05rem; color: #333333; display: flex; flex-wrap: wrap; gap: 15px;">`);

        equipment.forEach(item => {
            codeParts.push(`      <li style="background: #f8f8f8; border: 2px solid #ddd; border-radius: 8px; padding: 10px 15px; display: inline-block; font-weight: 500;">`);
            codeParts.push(`        <span style="color: #000000; font-size: 1.1rem; margin-right: 8px;">🔧</span>${escapeHtml(item)}`);
            codeParts.push(`      </li>`);
        });

        codeParts.push(`    </ul>`);
        codeParts.push(`  </div>`);
    }

    // Ingredients & Instructions
    scales.forEach((_, i) => {
        codeParts.push(`  <div class="scale-content scale-${i}">`);
        
        // Ingredients Section (First Row)
        codeParts.push(`    <div style="margin-bottom: 40px;">`);
        codeParts.push(`      <div class="ingredients-section">`);
        codeParts.push(`        <h2 style="color: #000000; border-bottom: 3px solid #000000; padding-bottom: 8px; margin-bottom: 15px; font-size: 1.8rem; font-weight: 600;">Ingredients</h2>`);
        
        // Unit selector UI near ingredients
        codeParts.push(`        <div class="control-selector unit-selector" style="margin-bottom: 20px;">`);
        codeParts.push(`            <label for="${scaleGroupId}-us-ctrl">US Units</label>`);
        codeParts.push(`            <label for="${scaleGroupId}-metric-ctrl">Metric Units</label>`);
        codeParts.push(`        </div>`);
        codeParts.push(`        <ul class="ingredients-list" style="list-style-type: none; padding-left: 0;">`);

        scaledIngredients[i].us.forEach((us, idx) => {
            const metric = scaledIngredients[i].metric[idx];
            codeParts.push(`          <li style="margin-bottom: 12px; padding-left: 25px; position: relative; font-size: 1.05rem; color: #333333; line-height: 1.5;">`);
            codeParts.push(`            <span style="position: absolute; left: 0; top: 0; color: #000000; font-size: 1.2rem; font-weight: bold;">•</span>`);
            codeParts.push(`            <span class="us-unit">${escapeHtml(us)}</span>`);
            codeParts.push(`            <span class="metric-unit">${escapeHtml(metric)}</span>`);
            codeParts.push(`          </li>`);
        });

        codeParts.push(`        </ul>`);
        codeParts.push(`      </div>`);
        codeParts.push(`    </div>`);
        
        // Instructions Section (Second Row)
        codeParts.push(`    <div style="margin-bottom: 30px;">`);
        codeParts.push(`      <div class="instructions-section">`);
        codeParts.push(`        <h2 style="color: #000000; border-bottom: 3px solid #000000; padding-bottom: 8px; margin-bottom: 15px; font-size: 1.8rem; font-weight: 600;">Instructions</h2>`);
        
        // Temperature selector UI near instructions
        codeParts.push(`        <div class="control-selector temp-selector" style="margin-bottom: 20px;">`);
        codeParts.push(`            <label for="${scaleGroupId}-fahr-ctrl">Fahrenheit</label>`);
        codeParts.push(`            <label for="${scaleGroupId}-cels-ctrl">Celsius</label>`);
        codeParts.push(`        </div>`);
        codeParts.push(`        <ol class="instructions-list" style="padding-left: 25px; font-size: 1.05rem; color: #333333;">`);

        instructions.forEach((inst, idx) => {
            const scaledInst = inst; // Instructions don't need scaling for quantities
            const metricInst = usToMetric(scaledInst);
            
            // Create comprehensive temperature conversion function
            function convertToCelsius(text) {
                // Handle "375°F (190°C)" format - extract just the Celsius part
                return text
                    .replace(/(\d+)°F\s*\((\d+)°C\)/g, (match, f, c) => {
                        return c + '°C';
                    })
                    // Handle standalone "375°F" format
                    .replace(/(\d+)°F/g, (match, f) => {
                        const c = Math.round((parseFloat(f) - 32) * 5 / 9);
                        return c + '°C';
                    });
            }
            
            // Create all 4 combinations
            const usFahrInst = scaledInst;
            const usCelsInst = convertToCelsius(scaledInst);
            const metricFahrInst = metricInst;
            const metricCelsInst = convertToCelsius(metricInst);
            
            codeParts.push(`          <li style="margin-bottom: 18px; padding-left: 8px; line-height: 1.6;">`);
            codeParts.push(`            <span class="us-unit fahrenheit-temp">${escapeHtml(usFahrInst)}</span>`);
            codeParts.push(`            <span class="us-unit celsius-temp">${escapeHtml(usCelsInst)}</span>`);
            codeParts.push(`            <span class="metric-unit fahrenheit-temp">${escapeHtml(metricFahrInst)}</span>`);
            codeParts.push(`            <span class="metric-unit celsius-temp">${escapeHtml(metricCelsInst)}</span>`);
            codeParts.push(`          </li>`);
        });

        codeParts.push(`        </ol>`);
        codeParts.push(`      </div>`);
        codeParts.push(`    </div>`);
        codeParts.push(`  </div>`);
    });

    // Tips
    if (tips.length > 0) {
        codeParts.push(`  <div style="margin-bottom: 30px; border-top: 2px solid #000000; padding-top: 25px;">`);
        codeParts.push(`    <h2 style="color: #000000; border-bottom: 3px solid #000000; padding-bottom: 8px; margin-bottom: 20px; font-size: 1.8rem; font-weight: 600;">Chef's Tips</h2>`);
        codeParts.push(`    <ul style="list-style-type: none; padding-left: 0; font-size: 1.05rem; color: #333333;">`);

        tips.forEach(tip => {
            codeParts.push(`      <li style="margin-bottom: 12px; padding-left: 25px; position: relative; line-height: 1.6;">`);
            codeParts.push(`        <span style="position: absolute; left: 0; top: 0; color: #000000; font-size: 1.2rem;">💡</span> ${escapeHtml(tip)}`);
            codeParts.push(`      </li>`);
        });

        codeParts.push(`    </ul>`);
        codeParts.push(`  </div>`);
    }

    codeParts.push(`</div>`);
    codeParts.push(`<!-- End Recipe -->`);

    const code = codeParts.join('\n');
    document.getElementById('code-output').textContent = code;
}

    function copyCode() {
        const codeOutput = document.getElementById('code-output');
        const text = codeOutput.textContent;
        if (navigator.clipboard) {
            navigator.clipboard.writeText(text).then(showNotification).catch(fallbackCopy);
        } else {
            fallbackCopy(text);
        }
    }

    function fallbackCopy(text) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showNotification();
    }

    function showNotification() {
        const notification = document.getElementById('notification');
        notification.classList.add('show');
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    function loadTestData() {
        // Basic recipe info - more comprehensive test case
        document.getElementById('recipe-title').value = 'Perfect Beef Wellington';
        document.getElementById('recipe-description').value = 'An elegant centerpiece featuring tender beef tenderloin wrapped in savory mushroom duxelles and flaky puff pastry. This restaurant-quality dish is perfect for special occasions and will impress any dinner guest.';
        document.getElementById('prep-time').value = '45';
        document.getElementById('cook-time').value = '35';
        document.getElementById('servings').value = '6';

        // Test ingredients with complex measurements, fractions, and various units
        const testIngredients = [
            '2 1/2 lb beef tenderloin, trimmed',
            '1 lb puff pastry, thawed',
            '1/4 cup Dijon mustard',
            '8 oz mushrooms, finely chopped',
            '4 oz pâté de foie gras (optional)',
            '6 thin slices prosciutto',
            '2 egg yolks, beaten',
            '2 tbsp olive oil',
            '1/2 cup dry white wine',
            '2 shallots, minced',
            '3 cloves garlic, minced',
            '1/4 cup fresh herbs (thyme, rosemary)',
            '1 tsp kosher salt',
            '1/2 tsp black pepper',
            '2 tbsp butter'
        ];

        // Test instructions with complex temperatures, times, and measurements
        const testInstructions = [
            'Preheat oven to 425°F (220°C) and season beef with salt and pepper',
            'Heat olive oil in large skillet over high heat',
            'Sear beef on all sides until golden brown, about 8-10 minutes total',
            'Remove from heat and brush with Dijon mustard, let cool completely',
            'Sauté mushrooms, shallots, and garlic for 12-15 minutes until moisture evaporates',
            'Add wine and herbs, cook 3-4 minutes until wine reduces',
            'Season mushroom mixture and cool to room temperature',
            'Lay plastic wrap on work surface, arrange prosciutto slices overlapping',
            'Spread pâté (if using) and mushroom mixture over prosciutto',
            'Place beef at one end and roll tightly using plastic wrap',
            'Refrigerate wrapped beef for 25-30 minutes',
            'Roll out puff pastry on floured surface to 14x10 inches',
            'Remove plastic from beef, place on pastry, brush edges with egg wash',
            'Roll pastry around beef, sealing seam with egg wash',
            'Place seam-side down on parchment-lined baking sheet',
            'Brush entire surface with egg wash and score decorative pattern',
            'Bake for 25-30 minutes until pastry is golden and internal temp reaches 125°F (52°C)',
            'Rest for 10-15 minutes before slicing with sharp knife'
        ];

        // Test tips with more detailed advice
        const testTips = [
            'Use a meat thermometer for perfect doneness - 125°F for medium-rare',
            'Let beef come to room temperature before cooking for even heating',
            'Make sure mushroom duxelles is completely dry to prevent soggy pastry',
            'Chill the wrapped beef to help pastry hold its shape during baking',
            'Score the pastry lightly to prevent cracking and create an elegant presentation',
            'Save leftover wine for the pan sauce - deglaze the searing pan with wine and butter'
        ];

        // Test equipment with more comprehensive tools
        const testEquipment = [
            'Large oven-safe skillet',
            'Sharp chef\'s knife',
            'Cutting board',
            'Large mixing bowl',
            'Plastic wrap',
            'Rolling pin',
            'Parchment paper',
            'Baking sheet',
            'Meat thermometer',
            'Pastry brush',
            'Fine-mesh sieve'
        ];

        // Clear existing items and populate with test data
        const ingredientInputs = document.querySelectorAll('#ingredients-list input');
        const instructionInputs = document.querySelectorAll('#instructions-list input');
        const tipInputs = document.querySelectorAll('#tips-list input');
        const equipmentInputs = document.querySelectorAll('#equipment-list input');

        // Fill ingredients
        ingredientInputs.forEach((input, i) => {
            input.value = testIngredients[i] || '';
        });

        // Fill instructions
        instructionInputs.forEach((input, i) => {
            input.value = testInstructions[i] || '';
        });

        // Fill tips
        tipInputs.forEach((input, i) => {
            input.value = testTips[i] || '';
        });

        // Fill equipment
        equipmentInputs.forEach((input, i) => {
            input.value = testEquipment[i] || '';
        });

        // Auto-generate code after loading test data
        setTimeout(generateCode, 100);
    }

    function downloadPDF() {
        // Get current recipe data
        const title = document.getElementById('recipe-title').value || 'Recipe';
        const description = document.getElementById('recipe-description').value || '';
        const prepTime = parseInt(document.getElementById('prep-time').value) || 0;
        const cookTime = parseInt(document.getElementById('cook-time').value) || 0;
        const servings = parseInt(document.getElementById('servings').value) || 0;

        const ingredients = Array.from(document.querySelectorAll('#ingredients-list input'))
            .map(input => input.value.trim())
            .filter(value => value);

        const instructions = Array.from(document.querySelectorAll('#instructions-list input'))
            .map(input => input.value.trim())
            .filter(value => value);

        const tips = Array.from(document.querySelectorAll('#tips-list input'))
            .map(input => input.value.trim())
            .filter(value => value);

        const equipment = Array.from(document.querySelectorAll('#equipment-list input'))
            .map(input => input.value.trim())
            .filter(value => value);

        // Check if we have enough data
        if (!title || ingredients.length === 0 || instructions.length === 0) {
            alert('Please fill in at least the recipe title, some ingredients, and instructions before downloading PDF.');
            return;
        }

        // Create PDF
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        let yPosition = 20;
        const pageWidth = doc.internal.pageSize.width;
        const margin = 20;
        const lineHeight = 7;
        
        // Title
        doc.setFontSize(20);
        doc.setFont(undefined, 'bold');
        doc.text(title, margin, yPosition);
        yPosition += 15;
        
        // Description
        if (description) {
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            const descLines = doc.splitTextToSize(description, pageWidth - 2 * margin);
            doc.text(descLines, margin, yPosition);
            yPosition += descLines.length * lineHeight + 10;
        }
        
        // Recipe info (prep, cook, servings)
        doc.setFontSize(12);
        doc.setFont(undefined, 'bold');
        let infoText = '';
        if (prepTime > 0) infoText += `Prep: ${prepTime} mins  `;
        if (cookTime > 0) infoText += `Cook: ${cookTime} mins  `;
        if (servings > 0) infoText += `Servings: ${servings}`;
        
        if (infoText) {
            doc.text(infoText, margin, yPosition);
            yPosition += 15;
        }
        
        // Equipment section (if any)
        if (equipment.length > 0) {
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.text('Tools & Equipment', margin, yPosition);
            yPosition += 10;
            
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            equipment.forEach(item => {
                // Check if we need a new page
                if (yPosition > doc.internal.pageSize.height - 30) {
                    doc.addPage();
                    yPosition = 20;
                }
                doc.text(`• ${item}`, margin + 5, yPosition);
                yPosition += lineHeight;
            });
            yPosition += 10;
        }
        
        // Ingredients section
        doc.setFontSize(16);
        doc.setFont(undefined, 'bold');
        doc.text('Ingredients', margin, yPosition);
        yPosition += 10;
        
        doc.setFontSize(11);
        doc.setFont(undefined, 'normal');
        ingredients.forEach(ingredient => {
            // Check if we need a new page
            if (yPosition > doc.internal.pageSize.height - 30) {
                doc.addPage();
                yPosition = 20;
            }
            doc.text(`• ${ingredient}`, margin + 5, yPosition);
            yPosition += lineHeight;
        });
        yPosition += 10;
        
        // Instructions section
        doc.setFontSize(16);
        doc.setFont(undefined, 'bold');
        doc.text('Instructions', margin, yPosition);
        yPosition += 10;
        
        doc.setFontSize(11);
        doc.setFont(undefined, 'normal');
        instructions.forEach((instruction, index) => {
            // Check if we need a new page
            if (yPosition > doc.internal.pageSize.height - 40) {
                doc.addPage();
                yPosition = 20;
            }
            
            const instructionLines = doc.splitTextToSize(`${index + 1}. ${instruction}`, pageWidth - 2 * margin - 10);
            doc.text(instructionLines, margin + 5, yPosition);
            yPosition += instructionLines.length * lineHeight + 3;
        });
        
        // Tips section (if any)
        if (tips.length > 0) {
            yPosition += 10;
            
            // Check if we need a new page
            if (yPosition > doc.internal.pageSize.height - 30) {
                doc.addPage();
                yPosition = 20;
            }
            
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.text('Chef\'s Tips', margin, yPosition);
            yPosition += 10;
            
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            tips.forEach(tip => {
                // Check if we need a new page
                if (yPosition > doc.internal.pageSize.height - 30) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                const tipLines = doc.splitTextToSize(`• ${tip}`, pageWidth - 2 * margin - 10);
                doc.text(tipLines, margin + 5, yPosition);
                yPosition += tipLines.length * lineHeight + 3;
            });
        }
        
        // Download the PDF
        const filename = title.replace(/[^a-z0-9]/gi, '_').toLowerCase() + '_recipe.pdf';
        doc.save(filename);
    }

    // Generate code on load
    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(generateCode, 500);
    });
</script>
</body>
</html>